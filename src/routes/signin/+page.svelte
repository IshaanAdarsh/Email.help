<script>
  let errorMsg = "";
  function removeUserInput() {
      document.getElementById("userMail").value = "";
      document.getElementById("userName").value = "";
      document.getElementById("password").value = "";
      document.getElementById("cpassword").value = "";
  }
  async function handleSubmit(event) {
    event.preventDefault();

    const email = document.getElementById("userMail").value;
    const name = document.getElementById("userName").value;
    const password = document.getElementById("password").value;
    const cpassword = document.getElementById("cpassword").value;
    if (password == cpassword) {
      const data = {
        email,
        name,
        password,
        cpassword,
      };

      try {
        const response = await fetch("http://localhost:5000/auth/signin", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });
        const json = await response.json();
        console.log(json);
        if (json.result === "Successfull") {
          localStorage.setItem("token", json.authToken);
          window.location.href = "/";
        } else {
          errorMsg = json.error;
          removeUserInput();
        }
      } catch (error) {
        errorMsg = error;
        removeUserInput();
      }
    } else {
      errorMsg = "passwords did not match";
      removeUserInput();
    }
  }
</script>

<body>
  <h1 >
    {#if errorMsg}
      <span class="text-red-600 error">
        {errorMsg}
      </span>
    {:else}
      Sign Up
    {/if}
  </h1>
  <form
    method="POST"
    class=
    id="signin-form"
    on:submit={handleSubmit}
  >
    <div >
      <label for="userMail"
        >Email:</label
      >
      <input
        type="email"
        id="userMail"
        name="userMail"
        placeholder="example@gmail.com"
        required
      />
    </div>
    <div class="space-y-2">
      <label for="userName" 
        >Username:</label
      >
      <input
        type="text"
       
        id="userName"
        name="userName"
        required
      />
    </div>
    <div class="space-y-2">
      <label for="password" 
        >Password:</label
      >
      <input
        type="password"
        
        id="password"
        name="password"
        required
      />
    </div>
    <div >
      <label for="cpassword"
        >Confirm Password:</label
      >
      <input
        type="password"
        
        id="cpassword"
        name="cpassword"
        required
      />
    </div>
    <button
      type="submit"
      
      >Sign Up
      <svg
        
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
        ><path
          fill-rule="evenodd"
          d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
          clip-rule="evenodd"
        /></svg
      >
    </button>
  </form>
</body>
